{
  "version": 3,
  "sources": ["../src/metro.mjs", "../src/mw/json.mjs", "../src/mw/thrower.mjs", "../src/mw/getdata.mjs", "../src/api.mjs", "../src/everything.mjs"],
  "sourcesContent": ["/**\n * base URL used to link to more information about an error message\n */\nconst metroURL = 'https://metro.muze.nl/details/'\n\n/**\n * Symbols:\n * - isProxy: used to test if an object is a metro Proxy to another object\n * - source: used to return the actual source (target) of a metro Proxy\n */\nif (!Symbol.metroProxy) {\n\tSymbol.metroProxy = Symbol('isProxy')\n}\nif (!Symbol.metroSource) {\n\tSymbol.metroSource = Symbol('source')\n}\n\n/**\n * Metro HTTP Client with middleware support\n * @method get\n * @method post\n * @method put\n * @method delete\n * @method patch\n * @method head\n * @method options\n * @method query\n * @method fetch\n */\nexport class Client\n{\n\tclientOptions = {\n\t\turl: typeof window != 'undefined' ? url(window.location) : url('https://localhost'),\n\t\tverbs: ['get','post','put','delete','patch','head','options','query']\n\t}\n\n\tstatic tracers = {}\n\n\t/**\n\t * @typedef {Object} ClientOptions\n\t * @property {Array} middlewares - list of middleware functions\n\t * @property {string|URL} url - default url of the client\n\t * @property {[string]} verbs - a list of verb methods to expose, e.g. ['get','post']\n\t * \n\t * Constructs a new metro client. Can have any number of params.\n\t * @params {ClientOptions|URL|Function|Client}\n\t * @returns {Client} - A metro client object with given or default verb methods\n\t */\n\tconstructor(...options)\n\t{\n\t\tfor (let option of options) {\n\t\t\tif (typeof option == 'string' || option instanceof String) {\n\t\t\t\tthis.clientOptions.url = url(this.clientOptions.url.href, option)\n\t\t\t} else if (option instanceof Function) {\n\t\t\t\tthis.#addMiddlewares([option])\n\t\t\t} else if (option && typeof option == 'object') {\n\t\t\t\tfor (let param in option) {\n\t\t\t\t\tif (param == 'middlewares') {\n\t\t\t\t\t\tthis.#addMiddlewares(option[param])\n\t\t\t\t\t} else if (param == 'url') {\n\t\t\t\t\t\tthis.clientOptions.url = url(this.clientOptions.url.href, option[param])\n\t\t\t\t\t} else if (typeof option[param] == 'function') {\n\t\t\t\t\t\tthis.clientOptions[param] = option[param](this.clientOptions[param], this.clientOptions)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.clientOptions[param] = option[param]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (const verb of this.clientOptions.verbs) {\n\t\t\tthis[verb] = async function(...options) {\n\t\t\t\treturn this.fetch(request(\n\t\t\t\t\tthis.clientOptions,\n\t\t\t\t\t...options,\n\t\t\t\t\t{method: verb.toUpperCase()}\n\t\t\t\t))\n\t\t\t}\n\t\t}\n\t\t//NOTE: intentionally not Object.freeze()-ing this, so that metro.api can extend this class\n\t}\n\n\t#addMiddlewares(middlewares)\n\t{\n\t\tif (typeof middlewares == 'function') {\n\t\t\tmiddlewares = [ middlewares ]\n\t\t}\n\t\tlet index = middlewares.findIndex(m => typeof m != 'function')\n\t\tif (index>=0) {\n\t\t\tthrow metroError('metro.client: middlewares must be a function or an array of functions '\n\t\t\t\t+metroURL+'client/invalid-middlewares/', middlewares[index])\n\t\t}\n\t\tif (!Array.isArray(this.clientOptions.middlewares)) {\n\t\t\tthis.clientOptions.middlewares = []\n\t\t}\n\t\tthis.clientOptions.middlewares = this.clientOptions.middlewares.concat(middlewares)\n\t}\n\n\t/**\n\t * Mimics the standard browser fetch method, but uses any middleware installed through\n\t * the constructor.\n\t * @param {Request|string|Object} - Required. The URL or Request object, accepts all types that are accepted by metro.request\n\t * @param {Object} - Optional. Any object that is accepted by metro.request\n\t * @return {Promise<Response|*>} - The metro.response to this request, or any other result as changed by any included middleware.\n\t */\n\tfetch(req, options)\n\t{\n\t\treq = request(req, options)\n\t\tif (!req.url) {\n\t\t\tthrow metroError('metro.client.'+req.method.toLowerCase()+': Missing url parameter '+metroURL+'client/fetch-missing-url/', req)\n\t\t}\n\t\tif (!options) {\n\t\t\toptions = {}\n\t\t}\n\t\tif (!(typeof options === 'object') \n\t\t\t|| options instanceof String) \n\t\t{\n\t\t\tthrow metroError('metro.client.fetch: Invalid options parameter '+metroURL+'client/fetch-invalid-options/', options)\n\t\t}\n\n\t\tconst metrofetch = async function browserFetch(req)\n\t\t{\n\t\t\tif (req[Symbol.metroProxy]) {\n\t\t\t\treq = req[Symbol.metroSource]\n\t\t\t}\n\t\t\tconst res = await fetch(req)\n\t\t\treturn response(res)\n\t\t}\n\t\t\n\t\tlet middlewares = [metrofetch].concat(this.clientOptions?.middlewares?.slice() || [])\n\t\toptions = Object.assign({}, this.clientOptions, options)\n\t\t//@TODO: do this once in constructor?\n\t\tlet next\n\t\tfor (let middleware of middlewares) {\n\t\t\tnext = (function(next, middleware) {\n\t\t\t\treturn async function(req) {\n\t\t\t\t\tlet res\n\t\t\t\t\tlet tracers = Object.values(Client.tracers)\n\t\t\t\t\tfor(let tracer of tracers) {\n\t\t\t\t\t\tif (tracer.request) {\n\t\t\t\t\t\t\ttracer.request.call(tracer, req, middleware)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tres = await middleware(req, next)\n\t\t\t\t\tfor(let tracer of tracers) {\n\t\t\t\t\t\tif (tracer.response) {\n\t\t\t\t\t\t\ttracer.response.call(tracer, res, middleware)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn res\n\t\t\t\t}\t\t\t\t\t\t\t\t\n\t\t\t})(next, middleware)\n\t\t}\n\t\treturn next(req)\n\t}\n\n\twith(...options) {\n\t\treturn new Client(deepClone(this.clientOptions), ...options)\n\t}\n\n\tget location() {\n\t\treturn this.clientOptions.url\n\t}\n\n}\n\n/**\n * Returns a new metro Client object.\n * @param {...ClientOptions|string|URL}\n * @return Client\n */\nexport function client(...options)\n{\n\treturn new Client(...deepClone(options))\n}\n\n/*\n//FIXME: is this needed?\nfunction appendHeaders(r, headers)\n{\n\tif (!Array.isArray(headers)) {\n\t\theaders = [headers]\n\t}\n\theaders.forEach((header) => {\n\t\tif (typeof header == 'function') {\n\t\t\tlet result = header(r.headers, r)\n\t\t\tif (result) {\n\t\t\t\tif (!Array.isArray(result)) {\n\t\t\t\t\tresult = [result]\n\t\t\t\t}\n\t\t\t\theaders = headers.concat(result)\n\t\t\t}\n\t\t}\n\t})\n\theaders.forEach((header) => {\n\t\tObject.entries(header).forEach(([name,value]) => {\t\t\t\n\t\t\tr.headers.append(name, value)\n\t\t})\n\t})\n}\n*/\n\nfunction getRequestParams(req, current)\n{\n\tlet params = current || {}\n\tif (!params.url && current.url) {\n\t\tparams.url = current.url\n\t}\n\t// function to fetch all relevant properties of a Request\n\tfor(let prop of ['method','headers','body','mode','credentials','cache','redirect',\n\t\t'referrer','referrerPolicy','integrity','keepalive','signal',\n\t\t'priority','url']) {\n\t\tlet value = req[prop]\n\t\tif (typeof value=='undefined' || value == null) {\n\t\t\tcontinue\n\t\t}\n\t\tif (value?.[Symbol.metroProxy]) {\n\t\t\tvalue = value[Symbol.metroSource]\n\t\t}\n\t\tif (typeof value == 'function') {\n\t\t\tparams[prop] = value(params[prop], params)\n\t\t} else {\n\t\t\tif (prop == 'url') {\n\t\t\t\tparams.url = url(params.url, value)\n\t\t\t} else if (prop == 'headers') {\n\t\t\t\t//FIXME: test and see if appendHeaders is needed\n\t\t\t\tparams.headers = new Headers(current.headers)\n\t\t\t\tif (!(value instanceof Headers)) {\n\t\t\t\t\tvalue = new Headers(req.headers)\n\t\t\t\t}\n\t\t\t\tfor (let [key, val] of value.entries()) {\n\t\t\t\t\tparams.headers.set(key, val)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams[prop] = value\n\t\t\t}\n\t\t}\n\t}\n\tif (req instanceof Request && req.data) {\n\t\t// Request.body is always transformed into ReadableStreem\n\t\t// metro.request.data is the original body passed to Request()\n\t\tparams.body = req.data\n\t}\n\treturn params\n}\n\n/**\n * @typedef {Request} MetroRequest\n * @property {Symbol(source)} - returns the target Request of this Proxy\n * @property {Symbol(isProxy)} - returns true\n * @method with - returns a new MetroRequest, with the given options added\n * @param {<RequestOptions|Request|string|URL|URLSearchParams|FormData|ReadableStream|\n *   Blob|ArrayBuffer|DataView|TypedArray>} ...options - request options, handled in order\n * \n * Returns a new metro Request object\n * @param {<RequestOptions|Request|string|URL|URLSearchParams|FormData|ReadableStream|\n *   Blob|ArrayBuffer|DataView|TypedArray>} ...options - request options, handled in order\n * @return {MetroRequest} - a new metro Request object\n */\nexport function request(...options)\n{\n\t// the standard Request constructor is a minefield\n\t// so first gather all the options together into a single\n\t// javascript object, then set it in one go\n\tlet requestParams = {\n\t\turl: typeof window != 'undefined' ? url(window.location) : url('https://localhost/'),\n\t\tduplex: 'half' // required when setting body to ReadableStream, just set it here by default already\n\t}\n\tfor (let option of options) {\n\t\tif (typeof option == 'string'\n\t\t\t|| option instanceof URL\n\t\t\t|| option instanceof URLSearchParams\n\t\t) {\n\t\t\trequestParams.url = url(requestParams.url, option)\n\t\t} else if (option && (\n\t\t\toption instanceof FormData\n\t\t\t|| option instanceof ReadableStream\n\t\t\t|| option instanceof Blob\n\t\t\t|| option instanceof ArrayBuffer\n\t\t\t|| option instanceof DataView\n\t\t)) {\n\t\t\trequestParams.body = option\n\t\t} else if (option && typeof option == 'object') {\n\t\t\tObject.assign(requestParams, getRequestParams(option, requestParams))\n\t\t}\n\t}\n\tlet r = new Request(requestParams.url, requestParams)\n\tlet data = requestParams.body\n\tif (data) {\n\t\tif (typeof data == 'object'\n\t\t\t&& !(data instanceof String)\n\t\t\t&& !(data instanceof ReadableStream)\n\t\t\t&& !(data instanceof Blob)\n\t\t\t&& !(data instanceof ArrayBuffer)\n\t\t\t&& !(data instanceof DataView)\n\t\t\t&& !(data instanceof FormData)\n\t\t\t&& !(data instanceof URLSearchParams)\n\t\t\t&& (typeof globalThis.TypedArray=='undefined' || !(data instanceof globalThis.TypedArray))\n\t\t) {\n\t\t\t// if we are here, body is set with an object of a type\n\t\t\t// not natively understood by Request, coerce it to a string\n\t\t\t// using toString({headers}) instead of just toString()\n\t\t\tif (typeof data.toString == 'function') {\n\t\t\t\trequestParams.body = data.toString({headers:r.headers})\n\t\t\t\tr = new Request(requestParams.url, requestParams)\n\t\t\t}\n\t\t}\n\t}\n\tObject.freeze(r)\n\treturn new Proxy(r, {\n\t\tget(target, prop) {\n\t\t\tlet result\n\t\t\tswitch(prop) {\n\t\t\t\tcase Symbol.metroSource:\n\t\t\t\t\tresult = target\n\t\t\t\tbreak\n\t\t\t\tcase Symbol.metroProxy:\n\t\t\t\t\tresult = true\n\t\t\t\tbreak\n\t\t\t\tcase 'with':\n\t\t\t\t\tresult = function(...options) {\n\t\t\t\t\t\tif (data) { // data is kept in a seperate value, if it set earlier\n\t\t\t\t\t\t\toptions.unshift({ body: data }) // unshifted so it can be overridden by options\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn request(target, ...options)\n\t\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t\tcase 'data':\n\t\t\t\t\tresult = data\n\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tif (target[prop] instanceof Function) {\n\t\t\t\t\t\tif (prop === 'clone') {\n\t\t\t\t\t\t\t// TODO: set req.data as the body of the clone\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresult = target[prop].bind(target)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = target[prop]\n\t\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\treturn result\n\t\t}\n\t})\n}\n\nfunction getResponseParams(res, current)\n{\n\t// function to fetch all relevant properties of a Response\n\tlet params = current || {}\n\tif (!params.url && current.url) {\n\t\tparams.url = current.url\n\t}\n\tfor(let prop of ['status','statusText','headers','body','url','type','redirected']) {\n\t\tlet value = res[prop]\n\t\tif (typeof value == 'undefined' || value == null) {\n\t\t\tcontinue\n\t\t}\n\t\tif (value?.[Symbol.metroProxy]) {\n\t\t\tvalue = value[Symbol.metroSource]\n\t\t}\n\t\tif (typeof value == 'function') {\n\t\t\tparams[prop] = value(params[prop], params)\n\t\t} else {\n\t\t\tif (prop == 'url') {\n\t\t\t\t//TODO: check if this should use metro.url\n\t\t\t\tparams.url = new URL(value, params.url || 'https://localhost/')\n\t\t\t} else {\n\t\t\t\tparams[prop] = value\n\t\t\t}\n\t\t}\n\t}\n\tif (res instanceof Response && res.data) {\n\t\t// Response.body is always transformed into ReadableStreem FIXME: check this\n\t\t// metro.response.data is the original body passed to Response()\n\t\tparams.body = res.data\n\t}\n\treturn params\n}\n\n/**\n * @typedef {Response} MetroResponse\n * @property {Symbol(source)} - returns the target Response of this Proxy\n * @property {Symbol(isProxy)} - returns true\n * @method with - returns a new MetroResponse, with the given options added\n * @param {<ResponseOptions|Response|string|URLSearchParams|FormData|ReadableStream|\n *   Blob|ArrayBuffer|DataView|TypedArray>} ...options - respomse options, handled in order\n * \n * Returns a new metro Response object\n * @param {<ResponseOptions|Response|string|URLSearchParams|FormData|ReadableStream|\n *   Blob|ArrayBuffer|DataView|TypedArray>} ...options - request options, handled in order\n * @return {MetroResponse} - a new metro Response object\n */\nexport function response(...options)\n{\n\tlet responseParams = {}\n\tfor (let option of options) {\n\t\tif (typeof option == 'string') {\n\t\t\tresponseParams.body = option\n\t\t} else if (option instanceof Response) {\n\t\t\tObject.assign(responseParams, getResponseParams(option, responseParams))\n\t\t} else if (option && typeof option == 'object') {\n\t\t\tif (option instanceof FormData\n\t\t\t\t|| option instanceof Blob\n\t\t\t\t|| option instanceof ArrayBuffer\n\t\t\t\t|| option instanceof DataView\n\t\t\t\t|| option instanceof ReadableStream\n\t\t\t\t|| option instanceof URLSearchParams\n\t\t\t\t|| option instanceof String\n\t\t\t\t|| (typeof globalThis.TypedArray != 'undefined' && option instanceof globalThis.TypedArray)\n\t\t\t) {\n\t\t\t\tresponseParams.body = option\n\t\t\t} else {\n\t\t\t\tObject.assign(responseParams, getResponseParams(option, responseParams))\n\t\t\t}\n\t\t}\n\t}\n\tlet data = undefined\n\tif (responseParams.body) {\n\t\tdata = responseParams.body\n\t}\n\t// if response status is 'null body status', don't set a body\n\t// that is response.status in [101, 204, 205, 304 ] \n\t// see: https://fetch.spec.whatwg.org/#statuses\n\tif ([101, 204, 205, 304 ].includes(responseParams.status)) {\n\t\tresponseParams.body = null\n\t}\n\tlet r = new Response(responseParams.body, responseParams)\t\n\tObject.freeze(r)\n\treturn new Proxy(r, {\n\t\tget(target, prop) {\n\t\t\tlet result\n\t\t\tswitch(prop) {\n\t\t\t\tcase Symbol.metroProxy:\n\t\t\t\t\tresult = true\n\t\t\t\tbreak\n\t\t\t\tcase Symbol.metroSource:\n\t\t\t\t\tresult = target\n\t\t\t\tbreak\n\t\t\t\tcase 'with':\n\t\t\t\t\tresult = function(...options) {\n\t\t\t\t\t\treturn response(target, ...options)\n\t\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t\tcase 'data':\n\t\t\t\t\t// body is turned into ReadableStream\n\t\t\t\t\t// data is the original body param\n\t\t\t\t\tresult = data\n\t\t\t\tbreak\n\t\t\t\tcase 'ok':\n\t\t\t\t\tresult = (target.status>=200) && (target.status<400)\n\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tif (typeof target[prop] == 'function') {\n\t\t\t\t\t\tresult = target[prop].bind(target)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = target[prop]\n\t\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\treturn result\n\t\t}\n\t})\n}\n\nfunction appendSearchParams(url, params)\n{\n\tif (typeof params == 'function') {\n\t\tparams(url.searchParams, url)\n\t} else {\n\t\tparams = new URLSearchParams(params)\n\t\tparams.forEach((value,key) => {\n\t\t\turl.searchParams.append(key, value)\n\t\t})\n\t}\n}\n\n/**\n * @typedef {URL} MetroURL\n * @property {Symbol(source)} - returns the target Request of this Proxy\n * @property {Symbol(isProxy)} - returns true\n * @method with - returns a new MetroRequest, with the given options added\n * @param {<URL|URLSearchParams|string|Object|Function>} ...options - url options, handled in order\n * \n * Returns a new metro URL object\n * @param {<URL|URLSearchParams|string|Object|Function>} ...options - url options, handled in order\n * @return {MetroURL} - a new metro URL object\n */\nexport function url(...options)\n{\n\tlet validParams = ['hash','host','hostname','href',\n\t\t'password','pathname','port','protocol','username','search','searchParams']\n\tlet u = new URL('https://localhost/')\n\tfor (let option of options) {\n\t\tif (typeof option == 'string' || option instanceof String) {\n\t\t\t// option is a relative or absolute url\n\t\t\tu = new URL(option, u)\n\t\t} else if (option instanceof URL \n\t\t\t|| (typeof Location != 'undefined' \n\t\t\t\t&& option instanceof Location)\n\t\t) {\n\t\t\tu = new URL(option)\n\t\t} else if (option instanceof URLSearchParams) {\n\t\t\tappendSearchParams(u, option)\n\t\t} else if (option && typeof option == 'object') {\n\t\t\tfor (let param in option) {\n\t\t\t\tswitch(param) {\n\t\t\t\t\tcase 'search':\n\t\t\t\t\t\tif (typeof option.search == 'function') {\n\t\t\t\t\t\t\toption.search(u.search, u)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tu.search = new URLSearchParams(option.search)\n\t\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t\tcase 'searchParams':\n\t\t\t\t\t\tappendSearchParams(u, option.searchParams)\n\t\t\t\t\tbreak\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tif (!validParams.includes(param)) {\n\t\t\t\t\t\t\tthrow metroError('metro.url: unknown url parameter '+metroURL+'url/unknown-param-name/', param)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (typeof option[param] == 'function') {\n\t\t\t\t\t\t\toption[param](u[param], u)\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\ttypeof option[param] == 'string' || option[param] instanceof String \n\t\t\t\t\t\t\t|| typeof option[param] == 'number' || option[param] instanceof Number\n\t\t\t\t\t\t\t|| typeof option[param] == 'boolean' || option[param] instanceof Boolean\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tu[param] = ''+option[param]\n\t\t\t\t\t\t} else if (typeof option[param] == 'object' && option[param].toString) {\n\t\t\t\t\t\t\tu[param] = option[param].toString()\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow metroError('metro.url: unsupported value for '+param+' '+metroURL+'url/unsupported-param-value/', options[param])\n\t\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow metroError('metro.url: unsupported option value '+metroURL+'url/unsupported-option-value/', option)\n\t\t}\n\t}\n\tObject.freeze(u)\n\treturn new Proxy(u, {\n\t\tget(target, prop) {\n\t\t\tlet result\n\t\t\tswitch(prop) {\n\t\t\t\tcase Symbol.metroProxy:\n\t\t\t\t\tresult = true\n\t\t\t\tbreak\n\t\t\t\tcase Symbol.metroSource:\n\t\t\t\t\tresult = target\n\t\t\t\tbreak\n\t\t\t\tcase 'with':\n\t\t\t\t\tresult = function(...options) {\n\t\t\t\t\t\treturn url(target, ...options)\n\t\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t\tcase 'filename':\n\t\t\t\t\tresult = target.pathname.split('/').pop()\n\t\t\t\tbreak\n\t\t\t\tcase 'folderpath':\n\t\t\t\t\tresult = target.pathname.substring(0,target.pathname.lastIndexOf('\\\\')+1)\n\t\t\t\tbreak\n\t\t\t\tcase 'authority':\n\t\t\t\t\tresult = target.username ?? ''\n\t\t\t\t\tresult += target.password ? ':'+target.password : ''\n\t\t\t\t\tresult += result ? '@' : ''\n\t\t\t\t\tresult += target.hostname\n\t\t\t\t\tresult += target.port ? ':'+target.port : ''\n\t\t\t\t\tresult += '/'\n\t\t\t\t\tresult = target.protocol + '//' + result\n\t\t\t\tbreak\n\t\t\t\tcase 'origin':\n\t\t\t\t\tresult = target.protocol + '//' + target.hostname\n\t\t\t\t\tresult += target.port ? ':' + target.port : ''\n\t\t\t\t\tresult += '/'\n\t\t\t\tbreak\n\t\t\t\tcase 'fragment':\n\t\t\t\t\tresult = target.hash.substring(1)\n\t\t\t\tbreak\n\t\t\t\tcase 'scheme':\n\t\t\t\t\tif (target.protocol) {\n\t\t\t\t\t\tresult = target.protocol.substring(0, target.protocol.length-1)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = ''\n\t\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tif (target[prop] instanceof Function) {\n\t\t\t\t\t\tresult = target[prop].bind(target)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = target[prop]\n\t\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\treturn result\n\t\t}\n\t})\n}\n\n/**\n * @typedef {FormData} MetroFormData\n * @property {Symbol(source)} - returns the target Request of this Proxy\n * @property {Symbol(isProxy)} - returns true\n * @method with - returns a new MetroRequest, with the given options added\n * @param {<FormData|Object>} ...options - url options, handled in order\n * \n * Returns a new metro FormData object\n * @param {<FormData|Object>} ...options - formdata options, handled in order\n * @return {MetroURL} - a new metro FormData object\n */\nexport function formdata(...options)\n{\n\tvar params = new FormData()\n\tfor (let option of options) {\n\t\tif (option instanceof HTMLFormElement) {\n\t\t\toption = new FormData(option)\n\t\t}\n\t\tif (option instanceof FormData) {\n\t\t\tfor (let entry of option.entries()) {\n\t\t\t\tparams.append(entry[0],entry[1])\n\t\t\t}\n\t\t} else if (option && typeof option == 'object') {\n\t\t\tfor (let entry of Object.entries(option)) {\n\t\t\t\tif (Array.isArray(entry[1])) {\n\t\t\t\t\tfor (let value of entry[1]) {\n\t\t\t\t\t\tparams.append(entry[0], value)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tparams.append(entry[0],entry[1])\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow new metroError('metro.formdata: unknown option type '+metroURL+'formdata/unknown-option-value/', option)\n\t\t}\n\t}\n\tObject.freeze(params)\n\treturn new Proxy(params, {\n\t\tget(target, prop) {\n\t\t\tlet result\n\t\t\tswitch(prop) {\n\t\t\t\tcase Symbol.metroProxy:\n\t\t\t\t\tresult = true\n\t\t\t\tbreak\n\t\t\t\tcase Symbol.metroSource:\n\t\t\t\t\tresult = target\n\t\t\t\tbreak\n\t\t\t\t//TODO: add toString() that can check\n\t\t\t\t//headers param: toString({headers:request.headers})\n\t\t\t\t//for the content-type\n\t\t\t\tcase 'with':\n\t\t\t\t\tresult = function(...options) {\n\t\t\t\t\t\treturn formdata(target, ...options)\n\t\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tif (target[prop] instanceof Function) {\n\t\t\t\t\t\tresult = target[prop].bind(target)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = target[prop]\n\t\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\treturn result\n\t\t}\n\t})\n}\n\nconst metroConsole = {\n\terror: (message, ...details) => {\n\t\tconsole.error('\u24C2\uFE0F  ',message, ...details)\n\t},\n\tinfo: (message, ...details) => {\n\t\tconsole.info('\u24C2\uFE0F  ',message, ...details)\n\t},\n\tgroup: (name) => {\n\t\tconsole.group('\u24C2\uFE0F  '+name)\n\t},\n\tgroupEnd: (name) => {\n\t\tconsole.groupEnd('\u24C2\uFE0F  '+name)\n\t}\n}\n\n\n/**\n * Custom Metro Error function that outputs to the console then throws an error\n */\nexport function metroError(message, ...details) {\n\tmetroConsole.error(message, ...details)\n\treturn new Error(message, ...details)\n}\n\n/**\n * Set of debugging tools to trace the request - response flow\n * Tracer are run on all metro fetch calls\n */\nexport const trace = {\n\t/**\n\t * Adds a named tracer function\n\t * @param {string} name - the name of the tracer\n\t * @param {Function} tracer - the tracer function to call\n\t */\n\tadd(name, tracer) {\n\t\tClient.tracers[name] = tracer\n\t},\n\t/**\n\t * Removes a named tracer function\n\t * @param {string} name\n\t */\n\tdelete(name) {\n\t\tdelete Client.tracers[name]\n\t},\n\t/**\n\t * Removes all tracer functions\n\t */\n\tclear() {\n\t\tClient.tracers = {}\n\t},\n\t/**\n\t * Returns a set of request and response tracer functions that use the\n\t * console.group feature to shows nested request/response pairs, with\n\t * most commonly needed information for debugging\n\t */\n\tgroup() {\n\t\tlet group = 0;\n\t\treturn {\n\t\t\trequest: (req, middleware) => {\n\t\t\t\tgroup++\n\t\t\t\tmetroConsole.group(group)\n\t\t\t\tmetroConsole.info(req?.url, req, middleware)\n\t\t\t},\n\t\t\tresponse: (res, middleware) => {\n\t\t\t\tmetroConsole.info(res?.body ? res.body[Symbol.metroSource]: null, res, middleware)\n\t\t\t\tmetroConsole.groupEnd(group)\n\t\t\t\tgroup--\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function deepClone(object) {\n\tif (Array.isArray(object)) {\n\t\treturn object.slice().map(deepClone)\n\t}\n\tif (object && typeof object==='object') {\n\t\tif (object.__proto__.constructor==Object || !object.__proto__) { // plain objects\n\t\t\tlet result = Object.assign({}, object)\n\t\t\tObject.keys(result).forEach(key => {\n\t\t\t\tresult[key] = deepClone(object[key])\n\t\t\t})\n\t\t\treturn result\n\t\t} else {\n\t\t\treturn object // don't clone custom classes or functions\n\t\t}\n\t}\n\treturn object\n}", "export default function jsonmw(options)\n{\n    options = Object.assign({\n        contentType: 'application/json',\n        reviver: null,\n        replacer: null,\n        space: ''\n    }, options)\n\n    return async function json(req, next) {\n        if (!req.headers.get('Accept')) {\n            req = req.with({\n                headers: {\n                    'Accept': options.accept ?? options.contentType\n                }\n            })\n        }\n        if (req.method!=='GET' && req.method!=='HEAD') {\n            //https://developer.mozilla.org/en-US/docs/Web/API/Request/body\n            if (req.data && typeof req.data=='object' && !(req.data instanceof ReadableStream)) {\n                const contentType = req.headers.get('Content-Type')\n                if (!contentType || isPlainText(contentType)) {\n                    req = req.with({\n                        headers: {\n                            'Content-Type':options.contentType,\n                        }\n                    })\n                }\n                if (isJSON(req.headers.get('Content-Type'))) {\n                    req = req.with({\n                        body: JSON.stringify(req.data, options.replacer, options.space)\n                    })\n                }\n            }\n        }\n        let res = await next(req)\n        if (isJSON(res.headers.get('Content-Type'))) {\n            let tempRes = res.clone()\n            let body = await tempRes.text()\n            try {\n                let json = JSON.parse(body, options.reviver)\n                return res.with({\n                    body: json\n                })\n            } catch(e) {\n                // ignore parse errors\n            }\n        }\n        return res\n    }\n}\n\n/*\n  this matches:\n  - application/json\n  - application/ld+json\n  - application/json; charset=utf-8\n  - application/ld+json; charset=utf-8\n*/\nconst jsonRE = /^application\\/([a-zA-Z0-9\\-_]+\\+)?json\\b/\nfunction isJSON(contentType)\n{\n    return jsonRE.exec(contentType)\n}\n\nfunction isPlainText(contentType)\n{\n    return /^text\\/plain\\b/.exec(contentType)\n}", "export default function throwermw(options) {\n\n\treturn async function thrower(req, next) {\n\t\tlet res = await next(req)\n\t\tif (!res.ok) {\n\t\t\tif (options && typeof options[res.status] == 'function') {\n\t\t\t\tres = options[res.status].apply(res, req)\n\t\t\t} else {\n\t\t\t\tthrow new Error(res.status+': '+res.statusText, {\n\t\t\t\t\tcause: res\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\treturn res\n\t}\n\n}", "export default function getdatamw()\n{\n\n\treturn async function getdata(req, next) {\n\t\tlet res = await next(req)\n\t\tif (res.ok && res.data) {\n\t\t\treturn res.data\n\t\t}\n\t\treturn res\n\t}\n\n}", "import * as metro from './metro.mjs'\nimport jsonmw from './mw/json.mjs'\nimport throwermw from './mw/thrower.mjs'\nimport getdatamw from './mw/getdata.mjs'\n\n/**\n * Metro API Client, extends Client\n * @param base ClientOptions|URL|String\n * @param methods {name:function,...} list of API methods to expose\n * This class extends the metro client to allow you to add your own\n * api client methods. Methods are bound to this API object.\n * All default client methods (get/post/put/etc.) still work, unless\n * overridden. If a response object has a data part, that will be \n * returned by the api client methods, instead of the normal response\n * The base API class will throw errors for network responses that\n * are not ok (e.g. status >= 400)\n * It will also return response.data, if that is set, instead of response\n */\nexport class API extends metro.Client\n{\n\tconstructor(base, methods, bind=null)\n\t{\n\t\tif (base instanceof metro.Client) {\n\t\t\tsuper(base.clientOptions, throwermw(), getdatamw())\n\t\t} else {\n\t\t\tsuper(base, throwermw(), getdatamw())\n\t\t}\n\t\tif (!bind) {\n\t\t\tbind = this\n\t\t}\n\t\tfor (const methodName in methods) {\n\t\t\tif (typeof methods[methodName] == 'function') {\n\t\t\t\t// all methods have a this pointing to the (root) API class\n\t\t\t\t// so that you can do this.get()/this.post() or this.section.method()\n\t\t\t\t// inside an API method\n\t\t\t\tthis[methodName] = methods[methodName].bind(bind)\n\t\t\t} else if (methods[methodName] && typeof methods[methodName] == 'object') {\n\t\t\t\t// allows for api.section.method()\n\t\t\t\tthis[methodName] = new this.constructor(base, methods[methodName], bind)\n\t\t\t} else { \n\t\t\t\t// allows you to set string/number values in the client api\n\t\t\t\tthis[methodName] = methods[methodName]\n\t\t\t}\n\t\t}\t\t\n\t}\n}\n\n/**\n * This extends the API class to automatically add\n * the jsonmw middleware. So any request.body that is\n * a normal object is automatically translated to JSON\n * Any response that returns JSON is automatically parsed\n * into response.data.\n * If no Accept header is set, it is added.\n */\nexport class JsonAPI extends API\n{\n\tconstructor(base, methods, bind=null) \n\t{\n\t\tif (base instanceof metro.Client) {\n\t\t\tsuper(base.with(jsonmw()), methods, bind)\n\t\t} else {\n\t\t\tsuper(metro.client(base, jsonmw()), methods, bind)\n\t\t}\n\t}\n}\n\n/**\n * Returns a new Metro API object\n * @param {...ClientOptions|string|URL}\n * @return API\n */\nexport function api(...options)\n{\n\treturn new API(...metro.deepClone(options))\n}\n\nexport function jsonApi(...options)\n{\n\treturn new JsonAPI(...metro.deepClone(options))\n}", "import * as m from './metro.mjs'\nimport { api, jsonApi } from './api.mjs'\nimport jsonmw from './mw/json.mjs'\nimport thrower from './mw/thrower.mjs'\nimport getdatamw from './mw/getdata.mjs'\n\nconst metro = Object.assign({}, m, {\n\tmw: {\n\t\tjsonmw,\n\t\tthrower,\n\t\tgedatamw\n\t},\n\tapi,\n\tjsonApi\n})\n\nif (!globalThis.metro) {\n\tglobalThis.metro = metro\n}\n\nexport default metro"],
  "mappings": "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",
  "names": ["options", "req", "next", "middleware", "url", "json"]
}
